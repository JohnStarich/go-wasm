<html>

<head>
	<meta charset="utf-8" />
	<script src="static/wasm_exec.js"></script>
	<script src="static/reload.js"></script>
	<script src="static/util.js"></script>
	<script src="static/fetch.js"></script>
	<link href="static/index.css" rel="stylesheet">
	<script>
		if (!WebAssembly.instantiateStreaming) { // polyfill
			WebAssembly.instantiateStreaming = async (resp, importObject) => {
				const source = await (await resp).arrayBuffer();
				return await WebAssembly.instantiate(source, importObject);
			};
		}

		const startTime = new Date().getTime()
		const go = new Go();
		WebAssembly.instantiateStreaming(fetch(`main.wasm`), go.importObject)
			.catch(e => {
				console.error("Failed to load go-wasm:", e)
			})
			.then(async cmd => {
				go.env = {
					'GOPROXY': 'https://proxy.golang.org/',
					'GOROOT': '/go',
					'HOME': '/home/me',
					'PATH': '/bin:/home/me/go/bin:/go/bin/js_wasm:/go/pkg/tool/js_wasm',
				}
				go.run(cmd.instance)
				console.debug(`go-wasm status: ${goWasm.ready ? 'ready' : 'not ready'}`)
				fs.mkdirSync("/go", 0700)
				await Promise.all([
					goWasm.overlayTarGzip('/go', '/go.tar.gz'),
					goWasm.install('editor'),
				])
				spawn("editor")
				spawn("go", "version")

				console.debug("Startup took", (new Date().getTime() - startTime) / 1000, "seconds")
			})
	</script>
</head>

<body></body>

</html>
